<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>jammny - Fighter安全团队</title>
    <link rel="stylesheet" type="text/css" href="./theme/css/screen.min.css">
    <link rel="stylesheet" type="text/css" href="./theme/css/highlight.min.css">
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />
    <link rel="publisher" href="">
    <link rel="apple-touch-startup-image" href="./theme/images/logo.png">
    <link type="text/plain" rel="socialmedia" href="./socialmedia.txt">
    <link rel="dns-prefetch" href="."/>
    <link rel="dns-prefetch" href="//www.gstatic.com"/>
    <link rel="dns-prefetch" href="//fonts.gstatic.com"/>
    <link rel="dns-prefetch" href="//fonts.googleapis.com"/>
    <link rel="dns-prefetch" href="//accounts.google.com"/>
    <link rel="dns-prefetch" href="//ssl.google-analytics.com"/>
    <link rel="dns-prefetch" href="//www.google-analytics.com"/>
    <link rel="dns-prefetch" href="//googleads.g.doubleclick.net"/>
    <link rel="dns-prefetch" href="//pagead2.googlesyndication.com"/>
    <link rel="dns-prefetch" href="//twemoji.maxcdn.com"/>
    <meta http-equiv="content-type" content="text/html;charset=utf-8">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="application-name" content="jammny - Fighter安全团队"/>
    <meta name="msapplication-starturl" content="http:."/>
    <meta name="msapplication-tooltip" content=""/>
    <meta name="msapplication-window" content="width=1024;height=768"/>
    <meta name="msapplication-task" content="name=jammny - Fighter安全团队;action-uri=http:.;icon-uri=./theme/images/favicon.ico"/>
    <meta name="msapplication-TileImage" content="./theme/images/apple-touch-icon-144x144.png"/>
    <meta name="msapplication-TileColor" content="#1F1F21"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="imagetoolbar" content="no">
    <meta http-equiv="pragma" content="cache">
    <meta http-equiv="cache-control" content="cache">
    <meta http-equiv="vary" content="content-language">
    <meta http-equiv="Cache-control" content="max-age=2592000, public">
    <meta http-equiv="content-style-type" content="text/css">
    <meta name="application-name" content="jammny - Fighter安全团队">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="google-site-verification" content="">
    <meta name="alexaVerifyID" content=""/>
    <meta name="wot-verification" content=""/>
    <meta name="msvalidate.01" content="" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="medium" content="mult">
    <meta name="adblock" content="disable">
    <meta name="rating" content="General">
    <meta name="resource-type" content="document">
    <meta name="revisit-after" content="1 days">
    <meta name="revisit" content="1">
    <meta name="robots" content="index,follow">
    <meta name="no-email-collection" content="http://www.unspam.com/noemailcollection/">
    <link rel="apple-touch-icon" sizes="152x152" href="./theme/images/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="144x144" href="./theme/images/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="114x114" href="./theme/images/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="./theme/images/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="76x76" href="./theme/images/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="72x72" href="./theme/images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="60x60" href="./theme/images/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="57x57" href="./theme/images/apple-touch-icon-57x57.png">
    <link rel="icon" type="image/png" href="./theme/images/favicon-196x196.png" sizes="196x196">
    <link rel="icon" type="image/png" href="./theme/images/favicon-160x160.png" sizes="160x160">
    <link rel="icon" type="image/png" href="./theme/images/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="./theme/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="./theme/images/favicon-16x16.png" sizes="16x16">
    <link rel="shortcut icon" href="./theme/images/favicon.ico">
    <script type="text/javascript">(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create', '', 'auto');ga('send', 'pageview');var _qevents = _qevents || [];</script>
    <script src="//twemoji.maxcdn.com/twemoji.min.js"></script>
</head>
<body class="home-template nav-closed" itemscope itemtype="http://schema.org/WebPage">
<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-ML9KT2"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-ML9KT2');</script>
<!-- End Google Tag Manager -->
    <meta itemprop="name" content="jammny - Fighter安全团队">
    <meta itemprop="url" content=".">
    <meta itemprop="headline" content="jammny - Fighter安全团队 || ">
    <meta itemprop="description about" content="">
    <meta itemprop="keywords" content="gnu, linux, software libre, código abierto, tecnología">
    <meta itemprop="primaryImageOfPage" content="./theme/images/logo.png">
    <meta itemprop="inLanguage" content="es">
<nav class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul role="menubar">
            <li class="nav-current" role="presentation"><a  href="./archives.html" title="jammny - Fighter安全团队 | Archives" itemprop="name" itemprop="significantLink">Archives</a></li>        
    </ul>
    <a class="subscribe-button icon-feed" href='feeds/all.atom.xml'  target='blank'>RSS</a>
</nav>
<span class="nav-cover"></span>    <div class="site-wrapper">
        <header class="main-header post-head" style="background-image: url(./theme/images/bear.jpg)" itemscope itemtype="http://schema.org/WPHeader">
            <nav class="main-nav overlay clearfix">
                <a class="menu-button" href="#">
                    <span class="burger">&#9776;</span>
                    <span class="word">Menu</span>
                </a>
            </nav>
            <div class="vertical">
                <div class="main-header-content inner">
                    <h1 class="page-title" itemprop="headline">jammny - Fighter安全团队</h1>
                    <h2 class="page-description" itemprop="description"></h2>
                </div>
            </div>
            <a class="scroll-down icon-arrow-left blink_me" href="#content" data-offset="-45">
                <span class="hidden">Scroll Down</span>
            </a>
        </header>
<main id="content" class="content" role="main">
    <article class="post" itemscope="" itemtype="http://schema.org/BlogPosting" itemprop="blogPost">
        <header class="post-header">
            <h1 class="post-title" itemprop="headline">手扒各种网站的加密算法</h1>
            <section class="post-meta">
                <span class="entry-author" itemscope="" itemtype="http://schema.org/Person" itemprop="author">
                    <span itemprop="name">jammny - Fighter安全团队</span></span>
                <time class="post-date" itemprop="datePublished" datetime="2023YYY-29M-%DD">星期五, 四月 14, 2023</time>
<nav role="navigation">
    <a class="newer-posts blink_me" href=".">&larr; Back</a>
</nav><br/>            </section>
        </header>
        <section class="post-content">
            <p><code>原创声明：转载本文请标注出处和作者，望尊重作者劳动成果！感谢！</code></p>
<blockquote>
<p>前言：以前的不会加解密的我抓包遇到数据包密文，awvs 扫描一下“安全”。学会手扒加密算法的我，各种逻辑漏洞手到擒来。</p>
</blockquote>
<p><a name="C2Gmx"></a></p>
<h3>案例一：G妹游戏（扒RSA算法）</h3>
<blockquote>
<p>网站链接：<a href="https://www.gm99.com/">https://www.gm99.com/</a></p>
</blockquote>
<p>1、用户登录的时候，网站对password字段进行了加密：<br /><img alt="image.png" src="images/1681460972386/1681460972387_0.png"><br /><img alt="image.png" src="images/1681460972386/1681460972838_1.png"><br />2、通过栈跟踪，定位js加密入口：<br /><img alt="image.png" src="images/1681460972386/1681460973172_2.png"><br /><img alt="image.png" src="images/1681460972386/1681460973534_3.png"><br />3、接着进入到调用encode的代码去：<br /><img alt="image.png" src="images/1681460972386/1681460973924_4.png"><br /><img alt="image.png" src="images/1681460972386/1681460974267_5.png"><br />4、通过分析，代码先将密码和时间戳进行了拼接，然后调用<code>jsencrypt</code>进行了rsa加密。而源码已经对<code>jsencrypt</code>进行了封装，键值对应内容如下：<br /><img alt="image.png" src="images/1681460972386/1681460974626_6.png"><br />5、由于前端是webpack构建方式，webpack有三点明显特征代码，可以先把模块加载器抠出来：</p>
<div class="highlight"><pre><span></span><code>第一点：他是一个自执行函数，位置一般在最前面。
第二点：他在函数体内调用call或者apply方法。
第三点：自执行函数后面，跟了多个方法，会由自执行函数根据参数去加载，例如t=2，那么就会加载2那个方法
</code></pre></div>

<p><img alt="image.png" src="images/1681460972386/1681460975081_7.png"><br />6、然后分别将键值对<code>3</code>和<code>4</code>的内容抠出来，<code>3</code>对应的是encode内容，<code>4</code>对应rsa加密的内容：<br /><img alt="image.png" src="images/1681460972386/1681460975401_8.png"><br />7、然后在自执行方法里面，添加调用加密的代码就可以了：<br /><img alt="image.png" src="images/1681460972386/1681460975837_9.png"><br />8、将全部代码放到浏览器跑一下就出来了：<br /><img alt="image.png" src="images/1681460972386/1681460976244_10.png"><br />9、当然直接用node跑代码也是可以的，因为调用的是标准加密库<code>jsencrypt</code>，因此完整的代码如下：</p>
<div class="highlight"><pre><span></span><code><span class="k">const</span><span class="w"> </span><span class="n">JSEncrypt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">&#39;./jsencrypt.min.js&#39;</span><span class="p">);</span>

<span class="o">!</span><span class="n">function</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">function</span><span class="w"> </span><span class="n">e</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">exports</span><span class="p">;</span>
<span class="w">        </span><span class="k">var</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">exports</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span>
<span class="w">            </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="n">s</span><span class="p">,</span>
<span class="w">            </span><span class="n">loaded</span><span class="p">:</span><span class="w"> </span><span class="o">!</span><span class="mi">1</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">exports</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="o">.</span><span class="n">exports</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">),</span>
<span class="w">        </span><span class="n">n</span><span class="o">.</span><span class="n">loaded</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="mi">0</span><span class="p">,</span>
<span class="w">        </span><span class="n">n</span><span class="o">.</span><span class="n">exports</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">e</span><span class="o">.</span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="o">.</span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="o">.</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">myfun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">myobj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">myfun</span><span class="p">;</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;123456&#39;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="err">要加密的内容</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">Date</span><span class="p">)</span><span class="o">.</span><span class="n">getTime</span><span class="p">;</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="err">获取时间戳</span>
<span class="w">    </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">myobj</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">password</span><span class="p">,</span><span class="w"> </span><span class="n">time</span><span class="p">))</span>
<span class="p">}({</span>
<span class="w">    </span><span class="mi">3</span><span class="p">:</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">var</span><span class="w"> </span><span class="n">s</span><span class="p">;</span>
<span class="w">        </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">function</span><span class="w"> </span><span class="n">n</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="bp">true</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">jsencrypt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">JSEncrypt</span><span class="p">,</span>
<span class="w">                </span><span class="n">this</span><span class="o">.</span><span class="n">jsencrypt</span><span class="o">.</span><span class="n">setPublicKey</span><span class="p">(</span><span class="s2">&quot;-----BEGIN PUBLIC KEY-----MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDq04c6My441Gj0UFKgrqUhAUg+kQZeUeWSPlAU9fr4HBPDldAeqzx1UR92KJHuQh/zs1HOamE2dgX9z/2oXcJaqoRIA/FXysx+z2YlJkSk8XQLcQ8EBOkp//MZrixam7lCYpNOjadQBb2Ot0U/Ky+jF2p+Ie8gSZ7/u+Wnr5grywIDAQAB-----END PUBLIC KEY-----&quot;</span><span class="p">))</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">n</span><span class="o">.</span><span class="n">prototype</span><span class="o">.</span><span class="n">encode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">var</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="err">?</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;|&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">t</span><span class="p">;</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">encodeURIComponent</span><span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">jsencrypt</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="p">,</span>
<span class="w">            </span><span class="n">s</span><span class="o">.</span><span class="n">exports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">),</span>
<span class="w">        </span><span class="o">!</span><span class="p">(</span><span class="nb nb-Type">void</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">exports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">))</span>
<span class="w">    </span><span class="p">},</span>
<span class="p">})</span>
</code></pre></div>

<p><img alt="image.png" src="images/1681460972386/1681460976566_11.png">
<a name="FDSIH"></a></p>
<h3>案例二：爱拍网（扒MD5算法）</h3>
<blockquote>
<p>目标网站：<a href="https://www.aipai.com/">https://www.aipai.com/</a></p>
</blockquote>
<p>在进行用户登录的时候，可以看得前端对用户口令信息进行了加密。如果我们需要对该接口进行暴力破解，那么需要知道加密算法是如何实现。<br /><img alt="image.png" src="images/1681460972386/1681460976996_12.png"><br />通过栈跟踪，定位js加密入口：<br /><img alt="image.png" src="images/1681460972386/1681460977553_13.png"><br /><img alt="image.png" src="images/1681460972386/1681460977988_14.png"><br />从代码中可以看到，参数“user”依赖开源库<code>jsencrypt</code>进行RSA加密。<br /><img alt="image.png" src="images/1681460972386/1681460978308_15.png"><br />参数“password”是用以下代码实现了MD5加密。<br /><img alt="image.png" src="images/1681460972386/1681460978702_16.png"><br />那么现在有两个思路，一个是通过自行导入第三方加密库（RSA和MD5）然后生成加密后的数据，另一个是直接扒目标网站上js代码。为了练习我们还是直接扣代码吧，首先是把md5这段直接拷贝下来，保存成md5.js：<br /><img alt="image.png" src="images/1681460972386/1681460979083_17.png"><br />然后是下载<code>jsencrypt.min.js</code>文件。由于这个js库存在<code>windows</code>属性，node是没办法直接用的。因此需要定义一下windows属性：<br /><img alt="image.png" src="images/1681460972386/1681460979432_18.png"><br />最后直接引用就行了：<br /><img alt="image.png" src="images/1681460972386/1681460979849_19.png"><br />验证一下成果，分别生成<code>用户名：test</code>和<code>用户名：test1234</code>的加密信息进行替换：：<br /><img alt="image.png" src="images/1681460972386/1681460980194_20.png"><br /><img alt="image.png" src="images/1681460972386/1681460980642_21.png"><br /><img alt="image.png" src="images/1681460972386/1681460981040_22.png"><br />根据响应内容，说明加密过程没有问题。那么后面就可以尝试编写一下爆破脚本进行测试了。
<a name="f8aT8"></a></p>
<h3>案例三：某项目系统（扒SM2国密算法）</h3>
<blockquote>
<p>项目上的系统，就不放链接了。</p>
</blockquote>
<p>burpsuite抓包数据加密如下：<br /><img alt="image.png" src="images/1681460972386/1681460981420_23.png"><br />因为加密数据是拼接在请求的url上，说明加密动作是在发送数据包之前，可以通过搜索url上的关键字来定位：<br /><img alt="image.png" src="images/1681460972386/1681460981766_24.png"><br />可以看到使用"/"将各个参数进行了拼接：<br /><img alt="image.png" src="images/1681460972386/1681460982216_25.png"><br />可以大概分析一下拼接的组合如下：</p>
<div class="highlight"><pre><span></span><code>/inndoo/sso-admin/base/common/captcha/sendSms/【手机号加密数据】/【图形验证码】/【验证码ID】/?encrypt=true
</code></pre></div>

<p>通过查看调用的堆栈，发现 s.mobile 加密动作如下：<br /><img alt="image.png" src="images/1681460972386/1681460982680_26.png"><br />在该位置下断点，跟进加密入口：<br /><img alt="image.png" src="images/1681460972386/1681460983021_27.png"><br />在如下位置成功找到加密对象和方法：<br /><img alt="image.png" src="images/1681460972386/1681460983498_28.png"><br /><img alt="image.png" src="images/1681460972386/1681460983860_29.png"><br />跟进到这个加密方法所在的js文件去：<br /><img alt="image.png" src="images/1681460972386/1681460984143_30.png"><br />下面就是实现sm2加密算法的代码了：<br /><img alt="image.png" src="images/1681460972386/1681460984467_31.png"><br />接下来就是把将这个js的代码扣下来，因为这个“chunk-vendors.xxxx.js”是webpack分包的内容，因此扣出注释包括起来的内容就行：</p>
<div class="highlight"><pre><span></span><code>(window[&quot;webpackJsonp&quot;] = window[&quot;webpackJsonp&quot;] || []).push([[&quot;chunk-vendors&quot;], {
// 从这里开始扣
    &quot;044b&quot;: function(e, t) {...},
    &quot;08a3&quot;: function(e, t, n) {...},
    ...
// 一直到这里结束
}])
</code></pre></div>

<p>将扣出来的内容放进如下模板：</p>
<div class="highlight"><pre><span></span><code><span class="o">!</span><span class="n">function</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">function</span><span class="w"> </span><span class="n">e</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">exports</span><span class="p">;</span>
<span class="w">        </span><span class="k">var</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">exports</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span>
<span class="w">            </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="n">s</span><span class="p">,</span>
<span class="w">            </span><span class="n">loaded</span><span class="p">:</span><span class="w"> </span><span class="o">!</span><span class="mi">1</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">exports</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="o">.</span><span class="n">exports</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">),</span>
<span class="w">        </span><span class="n">n</span><span class="o">.</span><span class="n">loaded</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="mi">0</span><span class="p">,</span>
<span class="w">        </span><span class="n">n</span><span class="o">.</span><span class="n">exports</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>

<span class="p">}({</span>
<span class="o">//</span><span class="w"> </span><span class="err">将扣出来的东西放着</span>
<span class="w">    </span><span class="s2">&quot;044b&quot;</span><span class="p">:</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="o">...</span><span class="p">},</span>
<span class="w">    </span><span class="s2">&quot;08a3&quot;</span><span class="p">:</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="o">...</span><span class="p">},</span>
<span class="w">    </span><span class="o">...</span>
<span class="o">//</span><span class="w"> </span><span class="err">一直到这里结束</span>
<span class="p">})</span>
</code></pre></div>

<p>将各个参数填充，成功输出加密数据：<br /><img alt="image.png" src="images/1681460972386/1681460984971_32.png"><br />将加密数据替换到数据包，重放成功：<br /><img alt="image.png" src="images/1681460972386/1681460985390_33.png"></p>
            <br/>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-7127443823639155" data-ad-slot="9038513565" data-ad-format="auto"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script>            <br/>
<nav class="pagination" role="navigation">
    <ul>
        <a rel="next" class="older-posts" href="./wang-luo-dai-li-jie-dian-de-an-quan-xing-yan-jiu.html" title="Leer: 网络代理节点的安全性研究">
            Leer la próxima publicación
        </a>
    </ul>
</nav>            <br/>
        </section>
        <footer class="post-footer">
        </footer>
    </article>
</main>
        <footer class="site-footer clearfix" role="contentinfo" itemscope itemtype="http://schema.org/WPFooter">
            <section class="copyright">
                <a itemprop="url" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" class="tooltip" data-tooltip="CC BY-NC-SA" target="_blank">
                CC Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
            </section>
            <section class="poweredby">Proudly published with <a href="https://getpelican.org">Pelican</a></section>
        </footer>
    </div>
    <script type="text/javascript" src="./theme/js/jquery-1.11.2.min.js"></script>
    <script type="text/javascript" src="./theme/js/jquery.fitvids.min.js"></script>
    <script type="text/javascript" src="./theme/js/index.min.js"></script>
    <script>twemoji.parse(document, {"size":16});</script>
</body>
</html>